<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Симулятор подбора паролей</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --primary: #94a3b8;
            --secondary: #e2e8f0;
            --text-color: #334155;
            --background: #f8fafc;
            --card-bg: #cbd5e1;
            --switch-bg-on: #334155;
            --switch-bg-off: #cbd5e1;
            --switch-ball: #ffffff;
            --modal-bg: rgba(0, 0, 0, 0.5);
            --modal-card: #f1f5f9;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--background);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 1rem;
        }

        .container {
            width: 100%;
            max-width: 700px;
        }

        .card {
            background-color: white;
            border-radius: 1.5rem;
            padding: 1.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        .input-field {
            background-color: white;
            border: 2px solid #e2e8f0;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }

        .input-field:focus {
            border-color: #94a3b8;
            box-shadow: 0 0 0 3px rgba(148, 163, 184, 0.5);
        }

        .btn {
            background-color: var(--primary);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 9999px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            transition: background-color 0.2s ease, transform 0.1s ease;
        }

        .btn:hover {
            background-color: #64748b;
        }

        .btn:active {
            transform: scale(0.95);
        }

        .info-card {
            background-color: #f1f5f9;
            color: #334155;
            padding: 1rem;
            border-radius: 1rem;
        }

        .info-card.green { background-color: #d1fae5; }
        .info-card.yellow { background-color: #fef9c3; }
        .info-card.red { background-color: #fee2e2; }
        
        .progress-bar-container {
            width: 100%;
            height: 12px;
            background-color: var(--secondary);
            border-radius: 6px;
            margin-top: 0.5rem;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background-color: #4ade80;
            transition: width 0.3s ease;
        }

        .range-slider {
            -webkit-appearance: none;
            width: 100%;
            height: 8px;
            background: #cbd5e1;
            outline: none;
            border-radius: 4px;
            transition: opacity .2s;
        }

        .range-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #94a3b8;
            cursor: pointer;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 44px;
            height: 24px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .toggle-slider {
            background-color: #2196F3;
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(20px);
        }
    </style>
</head>
<body>
    <div class="container flex flex-col items-center gap-6 p-4">
        <h1 class="text-4xl text-center font-bold text-slate-700">Симулятор подбора паролей</h1>

        <!-- Блок ввода и генерации пароля -->
        <div class="card w-full">
            <h2 class="text-2xl mb-4 text-center font-bold text-slate-700">Введите или создайте пароль</h2>
            <input type="text" id="passwordInput" placeholder="Введите пароль для проверки"
                   class="w-full p-4 text-lg rounded-xl input-field focus:outline-none transition-shadow"
            >
            
            <!-- Интерактивные элементы для генерации -->
            <div class="mt-6">
                <div class="flex items-center justify-between mb-2">
                    <p class="font-bold">Длина пароля: <span id="genLengthVal">12</span></p>
                </div>
                <input type="range" id="genLengthSlider" min="4" max="20" value="12" class="range-slider">
            </div>

            <div class="grid grid-cols-2 gap-4 mt-4 text-sm font-semibold">
                <label class="flex items-center space-x-2">
                    <span class="text-slate-600">Строчные буквы (a-z)</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="genLowercase" checked>
                        <span class="toggle-slider"></span>
                    </label>
                </label>
                <label class="flex items-center space-x-2">
                    <span class="text-slate-600">Заглавные буквы (A-Z)</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="genUppercase" checked>
                        <span class="toggle-slider"></span>
                    </label>
                </label>
                <label class="flex items-center space-x-2">
                    <span class="text-slate-600">Цифры (0-9)</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="genNumbers" checked>
                        <span class="toggle-slider"></span>
                    </label>
                </label>
                <label class="flex items-center space-x-2">
                    <span class="text-slate-600">Символы (!@#$)</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="genSymbols" checked>
                        <span class="toggle-slider"></span>
                    </label>
                </label>
            </div>
            
            <button id="generateBtn" class="btn w-full mt-6">Создать надежный пароль</button>
        </div>

        <!-- Блок анализа пароля -->
        <div class="card w-full mt-4">
            <h2 class="text-2xl mb-4 text-center font-bold text-slate-700">Анализ пароля</h2>
            
            <div class="grid grid-cols-2 gap-4 mb-4">
                <div id="lenInfoCard" class="info-card">
                    <p class="text-sm">Длина пароля:</p>
                    <p id="lengthVal" class="text-2xl font-bold mt-1">0</p>
                </div>
                <div id="charsetInfoCard" class="info-card">
                    <p class="text-sm">Типы символов:</p>
                    <p id="charsetVal" class="text-2xl font-bold mt-1">0</p>
                </div>
                <div id="numbersInfoCard" class="info-card">
                    <p class="text-sm">Цифры:</p>
                    <p id="hasNumbers" class="text-2xl font-bold mt-1">❌</p>
                </div>
                <div id="symbolsInfoCard" class="info-card">
                    <p class="text-sm">Символы:</p>
                    <p id="hasSymbols" class="text-2xl font-bold mt-1">❌</p>
                </div>
            </div>
            
            <div class="info-card mb-4">
                <h3 class="font-bold text-lg">Надежность пароля:</h3>
                <div class="progress-bar-container">
                    <div id="strengthBar" class="progress-bar" style="width: 0%;"></div>
                </div>
                <p id="strengthText" class="mt-2 text-sm text-gray-600">Слишком простой...</p>
            </div>
            
            <div class="info-card green mb-4">
                <h3 class="font-bold text-lg">Количество комбинаций:</h3>
                <p id="combinationsVal" class="text-xl mt-2 font-mono">0</p>
            </div>
            
            <div class="info-card yellow mb-4">
                <h3 class="font-bold text-lg">Время подбора пароля:</h3>
                <p id="bruteForceTime" class="text-xl mt-2 font-mono">0 секунд</p>
                <p id="benchmarkInfo" class="text-xs text-gray-500 mt-1">
                    Производится расчет производительности вашего компьютера...
                </p>
            </div>

            <button id="bruteForceBtn" class="btn w-full mt-4">Начать подбор пароля</button>
            <p id="bruteForceResult" class="text-center mt-4 text-lg font-bold" style="display: none;"></p>
        </div>

    </div>

    <script>
        const passInp = document.getElementById('passwordInput');
        const generateBtn = document.getElementById('generateBtn');
        const bruteForceBtn = document.getElementById('bruteForceBtn');
        const bruteForceResult = document.getElementById('bruteForceResult');

        const lengthVal = document.getElementById('lengthVal');
        const charsetVal = document.getElementById('charsetVal');
        const strengthBar = document.getElementById('strengthBar');
        const strengthText = document.getElementById('strengthText');
        const combinationsVal = document.getElementById('combinationsVal');
        const bruteForceTime = document.getElementById('bruteForceTime');
        const benchmarkInfo = document.getElementById('benchmarkInfo');

        const genLengthSlider = document.getElementById('genLengthSlider');
        const genLengthVal = document.getElementById('genLengthVal');
        const genLowercase = document.getElementById('genLowercase');
        const genUppercase = document.getElementById('genUppercase');
        const genNumbers = document.getElementById('genNumbers');
        const genSymbols = document.getElementById('genSymbols');

        const lenInfoCard = document.getElementById('lenInfoCard');
        const charsetInfoCard = document.getElementById('charsetInfoCard');
        const numbersInfoCard = document.getElementById('numbersInfoCard');
        const symbolsInfoCard = document.getElementById('symbolsInfoCard');
        const hasNumbersText = document.getElementById('hasNumbers');
        const hasSymbolsText = document.getElementById('hasSymbols');

        let bruteForceWorker;
        let bruteForceOperationsPerSec = 0;

        // Символы для анализа и подбора (включая русские)
        const charsets = {
            numbers: '0123456789',
            lowercase: 'abcdefghijklmnopqrstuvwxyz',
            uppercase: 'ABCDEFGHIJKLMNOPQRSTUVWXYZ',
            symbols: '!@#$%^&*()_+-=[]{}|;:,.<>/?`~',
            lowercaseRU: 'абвгдеёжзийклмнопрстуфхцчшщъыьэюя',
            uppercaseRU: 'АБВГДЕЁЖЗИКЛМНОПРСТУФХЦЧШЩЪЫЬЭЮЯ'
        };

        const runBenchmark = () => {
            const duration = 1000;
            const startTime = performance.now();
            let count = 0;
            while (performance.now() - startTime < duration) {
                let temp = Math.random();
                count++;
            }
            bruteForceOperationsPerSec = count;
            benchmarkInfo.textContent = `Производительность: ~${(bruteForceOperationsPerSec / 1000000).toLocaleString('ru-RU', { maximumFractionDigits: 2 })} млн операций в секунду.`;
            updatePasswordInfo();
        };

        const updatePasswordInfo = () => {
            const password = passInp.value;
            const len = password.length;
            const hasNumbers = /[0-9]/.test(password);
            const hasLowercase = /[a-zа-я]/.test(password);
            const hasUppercase = /[A-ZА-Я]/.test(password);
            const hasSymbols = /[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?`~]/.test(password);

            let totalCharsetSize = 0;
            let usedCharsCount = 0;

            if (hasNumbers) {
                totalCharsetSize += charsets.numbers.length;
                usedCharsCount++;
                hasNumbersText.textContent = '✅';
                numbersInfoCard.className = 'info-card green';
            } else {
                hasNumbersText.textContent = '❌';
                numbersInfoCard.className = 'info-card red';
            }
            
            if (hasSymbols) {
                totalCharsetSize += charsets.symbols.length;
                usedCharsCount++;
                hasSymbolsText.textContent = '✅';
                symbolsInfoCard.className = 'info-card green';
            } else {
                hasSymbolsText.textContent = '❌';
                symbolsInfoCard.className = 'info-card red';
            }
            
            if (hasLowercase) totalCharsetSize += charsets.lowercase.length + charsets.lowercaseRU.length;
            if (hasUppercase) totalCharsetSize += charsets.uppercase.length + charsets.uppercaseRU.length;
            if (hasLowercase || hasUppercase) usedCharsCount++;

            lengthVal.textContent = len;
            charsetVal.textContent = usedCharsCount;

            lenInfoCard.className = 'info-card ' + (len >= 8 ? 'green' : (len >= 4 ? 'yellow' : 'red'));
            charsetInfoCard.className = 'info-card ' + (usedCharsCount >= 3 ? 'green' : (usedCharsCount >= 2 ? 'yellow' : 'red'));

            // Расчет комбинаций
            const combinations = totalCharsetSize > 0 ? BigInt(totalCharsetSize) ** BigInt(len) : BigInt(0);
            combinationsVal.textContent = combinations.toLocaleString('ru-RU');

            // Расчет времени подбора
            if (bruteForceOperationsPerSec > 0) {
                let seconds = Number(combinations) / bruteForceOperationsPerSec;
                if (seconds < 1e-6) {
                    bruteForceTime.textContent = 'менее 1 мкс';
                } else if (seconds < 1e-3) {
                    bruteForceTime.textContent = (seconds * 1000).toLocaleString('ru-RU', { maximumFractionDigits: 2 }) + ' мс';
                } else if (seconds < 60) {
                    bruteForceTime.textContent = seconds.toLocaleString('ru-RU', { maximumFractionDigits: 2 }) + ' секунд';
                } else if (seconds < 3600) {
                    bruteForceTime.textContent = (seconds / 60).toLocaleString('ru-RU', { maximumFractionDigits: 2 }) + ' минут';
                } else if (seconds < 86400) {
                    bruteForceTime.textContent = (seconds / 3600).toLocaleString('ru-RU', { maximumFractionDigits: 2 }) + ' часов';
                } else if (seconds < 31536000) {
                    bruteForceTime.textContent = (seconds / 86400).toLocaleString('ru-RU', { maximumFractionDigits: 2 }) + ' дней';
                } else {
                    const years = seconds / 31536000;
                    if (years > 100000) {
                        bruteForceTime.textContent = 'Более 100 000 лет';
                    } else {
                        bruteForceTime.textContent = years.toLocaleString('ru-RU', { maximumFractionDigits: 2 }) + ' лет';
                    }
                }
            } else {
                bruteForceTime.textContent = 'Нет данных';
            }

            // Расчет надежности. Сумма баллов теперь может достигать 100
            let strength = 0;
            if (len > 0) {
                if (len >= 12) strength += 40;
                else if (len >= 8) strength += 20;
                
                if (hasNumbers) strength += 20;
                if (hasLowercase && hasUppercase) strength += 20;
                else if (hasLowercase || hasUppercase) strength += 10;
                
                if (hasSymbols) strength += 20;
            }

            strengthBar.style.width = `${Math.min(strength, 100)}%`;
            strengthBar.style.backgroundColor = strength > 75 ? '#10b981' : (strength > 40 ? '#f59e0b' : '#ef4444');
            strengthText.textContent = strength > 75 ? 'Очень надежный!' : (strength > 40 ? 'Средняя надежность' : 'Слишком простой...');
        };

        const generatePassword = () => {
            const passLength = genLengthSlider.value;
            let availableChars = '';
            
            // Использование только латинских символов для генерации
            if (genLowercase.checked) availableChars += charsets.lowercase;
            if (genUppercase.checked) availableChars += charsets.uppercase;
            if (genNumbers.checked) availableChars += charsets.numbers;
            if (genSymbols.checked) availableChars += charsets.symbols;

            if (availableChars.length === 0) {
                showModal('Ошибка генерации', 'Пожалуйста, выберите хотя бы один тип символов.');
                return;
            }

            let newPass = '';
            for (let i = 0; i < passLength; i++) {
                newPass += availableChars.charAt(Math.floor(Math.random() * availableChars.length));
            }
            passInp.value = newPass;
            updatePasswordInfo();
        };

        const workerCode = `
            self.onmessage = (event) => {
                if (event.data.command === 'stop') {
                    self.stopped = true;
                } else if (event.data.command === 'start') {
                    self.stopped = false;
                    const { password, charset, startTime } = event.data;
                    const charsetSize = charset.length;
                    const passwordLength = password.length;
                    let attempts = 0;
                    let lastUpdateTime = Date.now();
                    
                    const guessArr = new Array(passwordLength).fill(charset[0]);
                    
                    while (!self.stopped) {
                        attempts++;
                        let currentGuess = guessArr.join('');

                        if (currentGuess === password) {
                            self.postMessage({ type: 'found', attempts, password, totalTime: Date.now() - startTime });
                            return;
                        }

                        if (Date.now() - lastUpdateTime >= 250) {
                            self.postMessage({ type: 'progress', attempts });
                            lastUpdateTime = Date.now();
                        }

                        let i = passwordLength - 1;
                        while (i >= 0) {
                            let charIndex = charset.indexOf(guessArr[i]);
                            if (charIndex < charsetSize - 1) {
                                guessArr[i] = charset[charIndex + 1];
                                break;
                            } else {
                                guessArr[i] = charset[0];
                                i--;
                            }
                        }
                        if (i < 0) {
                            break; 
                        }
                    }
                    if (!self.stopped) {
                        self.postMessage({ type: 'finished', attempts, totalTime: Date.now() - startTime });
                    }
                }
            };
        `;
        
        const workerBlob = new Blob([workerCode], { type: 'application/javascript' });
        const workerUrl = URL.createObjectURL(workerBlob);
        
        const formatTime = (ms) => {
            let seconds = ms / 1000;
            if (seconds < 1) return `${(seconds * 1000).toFixed(0)} мс`;
            if (seconds < 60) return `${seconds.toFixed(2)} с`;
            const minutes = Math.floor(seconds / 60);
            seconds = Math.floor(seconds % 60);
            return `${minutes} мин ${seconds} с`;
        };

        const initWorker = () => {
            if (bruteForceWorker) bruteForceWorker.terminate();
            bruteForceWorker = new Worker(workerUrl);
            bruteForceWorker.onmessage = (event) => {
                const { type, attempts, password, totalTime } = event.data;
                if (type === 'progress') {
                    bruteForceResult.textContent = `Подбор запущен... Попыток: ${attempts.toLocaleString('ru-RU')}`;
                    bruteForceResult.style.color = '#334155';
                    bruteForceResult.style.display = 'block';
                } else if (type === 'found') {
                    bruteForceResult.textContent = `Пароль найден: "${password}" за ${attempts.toLocaleString('ru-RU')} попыток! (${formatTime(totalTime)})`;
                    bruteForceResult.style.color = '#10b981';
                    bruteForceBtn.textContent = 'Начать подбор пароля';
                    passInp.disabled = false;
                    generateBtn.disabled = false;
                } else if (type === 'finished') {
                    bruteForceResult.textContent = `Подбор завершен. Проверено ${attempts.toLocaleString('ru-RU')} комбинаций за ${formatTime(totalTime)}.`;
                    bruteForceResult.style.color = '#ef4444';
                    bruteForceBtn.textContent = 'Начать подбор пароля';
                    passInp.disabled = false;
                    generateBtn.disabled = false;
                }
            };
        };

        const startBruteForce = () => {
            const password = passInp.value;
            if (!password) return;

            bruteForceBtn.textContent = 'Остановить';
            passInp.disabled = true;
            generateBtn.disabled = true;
            
            bruteForceResult.textContent = 'Подбор запущен...';
            bruteForceResult.style.color = '#334155';
            bruteForceResult.style.display = 'block';

            let charset = '';
            if (/[0-9]/.test(password)) charset += charsets.numbers;
            if (/[a-z]/.test(password)) charset += charsets.lowercase;
            if (/[A-Z]/.test(password)) charset += charsets.uppercase;
            if (/[а-я]/.test(password)) charset += charsets.lowercaseRU;
            if (/[А-Я]/.test(password)) charset += charsets.uppercaseRU;
            if (/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?`~]/.test(password)) charset += charsets.symbols;
            
            if (charset.length === 0) {
                bruteForceResult.textContent = 'Пароль не содержит поддерживаемых символов!';
                bruteForceResult.style.color = '#ef4444';
                bruteForceResult.style.display = 'block';
                bruteForceBtn.textContent = 'Начать подбор пароля';
                passInp.disabled = false;
                generateBtn.disabled = false;
                return;
            }

            initWorker();
            bruteForceWorker.postMessage({ command: 'start', password, charset, startTime: Date.now() });
        };
        
        bruteForceBtn.addEventListener('click', () => {
            if (bruteForceBtn.textContent === 'Начать подбор пароля') {
                startBruteForce();
            } else {
                bruteForceWorker.postMessage({ command: 'stop' });
                bruteForceResult.textContent = 'Подбор остановлен.';
                bruteForceResult.style.color = '#ef4444';
                bruteForceBtn.textContent = 'Начать подбор пароля';
                passInp.disabled = false;
                generateBtn.disabled = false;
            }
        });

        generateBtn.addEventListener('click', generatePassword);
        passInp.addEventListener('input', updatePasswordInfo);
        genLengthSlider.addEventListener('input', () => {
            genLengthVal.textContent = genLengthSlider.value;
        });

        window.onload = () => {
            runBenchmark();
        };

        // Custom Modal UI
        const infoModal = document.createElement('div');
        infoModal.className = 'fixed inset-0 z-50 flex items-center justify-center hidden';
        infoModal.style.backgroundColor = 'var(--modal-bg)';
        infoModal.innerHTML = `
            <div class="bg-white p-6 rounded-2xl shadow-xl w-11/12 md:w-1/3">
                <h3 id="modalTitle" class="text-2xl font-bold mb-4"></h3>
                <p id="modalText" class="text-gray-700"></p>
                <button id="closeModalBtn" class="btn w-full mt-6">ОК</button>
            </div>
        `;
        document.body.appendChild(infoModal);

        const modalTitle = document.getElementById('modalTitle');
        const modalText = document.getElementById('modalText');
        const closeModalBtn = document.getElementById('closeModalBtn');
        
        function showModal(title, text) {
            modalTitle.textContent = title;
            modalText.textContent = text;
            infoModal.style.display = 'flex';
        }

        closeModalBtn.addEventListener('click', () => {
            infoModal.style.display = 'none';
        });

        window.addEventListener('click', (event) => {
            if (event.target === infoModal) {
                infoModal.style.display = 'none';
            }
        });
        
    </script>
</body>
</html>
